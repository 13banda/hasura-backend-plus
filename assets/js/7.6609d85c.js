(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{332:function(t,e,a){"use strict";a.r(e);var r=a(18),s=Object(r.a)({},(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"configuration"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#configuration"}},[t._v("#")]),t._v(" Configuration")]),t._v(" "),a("h2",{attrs:{id:"general"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#general"}},[t._v("#")]),t._v(" General")]),t._v(" "),a("h2",{attrs:{id:"connect-to-hasura"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#connect-to-hasura"}},[t._v("#")]),t._v(" Connect to Hasura")]),t._v(" "),a("p",[t._v("In order to connect HBP to Hasura, you need to provide the Hasura GraphQL endpoint in the "),a("code",[t._v("HASURA_ENDPOINT")]),t._v(" environment variable. Note that this should include the full path of the GraphQL endpoint, usually ending with "),a("code",[t._v("/v1/graphql")]),t._v(".\nFor example, in the "),a("a",{attrs:{href:"https://github.com/nhost/hasura-backend-plus/blob/master/docker-compose.yaml",target:"_blank",rel:"noopener noreferrer"}},[t._v("default docker-compose file of the HBP repository"),a("OutboundLink")],1),t._v(", "),a("code",[t._v("HASURA_ENDPOINT")]),t._v(" is "),a("code",[t._v("http://graphql-engine:8080/v1/graphql")]),t._v(".")]),t._v(" "),a("p",[t._v("You also need to provide a valid Hasura admin secret key in the "),a("code",[t._v("HASURA_GRAPHQL_ADMIN_SECRET")]),t._v(" environment variable. Note that this variable is mandatory for HBP to work, i.e. HBP won't work if your Hasura instance is not secured with such an admin key. You can find further reading about admin secret keys in the "),a("a",{attrs:{href:"https://hasura.io/docs/1.0/graphql/manual/deployment/production-checklist.html#set-an-admin-secret",target:"_blank",rel:"noopener noreferrer"}},[t._v("Hasura documentation"),a("OutboundLink")],1),t._v(".")]),t._v(" "),a("p",[t._v("The last point of attention is to make sure both HBP and Hasura are using the same JWT configuration: as HBP will generate the JWT used for authentication in Hasura, it is very important that JWT is configured in a way that Hasura understands it. You will find more information on how to configure JWT in HBP.")]),t._v(" "),a("h2",{attrs:{id:"configure-jwt"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#configure-jwt"}},[t._v("#")]),t._v(" Configure JWT")]),t._v(" "),a("h2",{attrs:{id:"migrations"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#migrations"}},[t._v("#")]),t._v(" Migrations")]),t._v(" "),a("p",[t._v("By default, HBP checks when starting if its schema is already present in the database. If not, it runs the necessary SQL migrations and loads the related Hasura metadata, while keeping the existing database and Hasura metadata unchanged.")]),t._v(" "),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[t._v("WARNING")]),t._v(" "),a("p",[t._v("Before running migrations on any sort, it is recommended to make a backup of your database.")])]),t._v(" "),a("p",[t._v("The HBP migration system is planned to automatically apply migrations further to v2.")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),a("p",[t._v("The HBP migration system relies on "),a("a",{attrs:{href:"https://hasura.io/docs/1.0/graphql/manual/hasura-cli/index.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Hasura CLI"),a("OutboundLink")],1),t._v(" and uses a "),a("a",{attrs:{href:"https://hasura.io/docs/1.0/graphql/manual/migrations/config-v1/index.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("v1 migrations/metadata configuration"),a("OutboundLink")],1),t._v(", as the config v2 doesn't allow metadata incremental change (yet?).")])]),t._v(" "),a("p",[t._v("You can disable this automatic check and migration system in setting then "),a("code",[t._v("AUTO_MIGRATE")]),t._v(" environment variable to "),a("code",[t._v("false")]),t._v(".")]),t._v(" "),a("h3",{attrs:{id:"migrating-from-hbp-v1"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#migrating-from-hbp-v1"}},[t._v("#")]),t._v(" Migrating from HBP v1")]),t._v(" "),a("p",[t._v("Hasura Backend Plus v2 introduces some brand new features, coming with some breaking changes:")]),t._v(" "),a("ul",[a("li",[t._v("While all the existing v1 features exist, the "),a("a",{attrs:{href:"api"}},[t._v("API endpoints")]),t._v(" have been modified. You may need to change your frontend applications accordingly.")]),t._v(" "),a("li",[t._v("The Storage module have been completely rewritten. ")]),t._v(" "),a("li",[t._v("The refresh token is now stored in an "),a("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/HTTP/Cookies",target:"_blank",rel:"noopener noreferrer"}},[t._v("HTTP cookie"),a("OutboundLink")],1)])]),t._v(" "),a("p",[t._v("If you are upgrading HBP v1 to v2, you need to set "),a("code",[t._v("AUTO_MIGRATE")]),t._v(" accordingly:")]),t._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("AUTO_MIGRATE")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("v1\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("p",[t._v("The first time HBP starts, it will then transform the legacy HBP v1 schema and metadata into the v2 ones, and load the account data.")]),t._v(" "),a("p",[t._v("Please note that your users will be disconnected during the process.")]),t._v(" "),a("h2",{attrs:{id:"registration"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#registration"}},[t._v("#")]),t._v(" Registration")]),t._v(" "),a("h3",{attrs:{id:"activate-accounts"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#activate-accounts"}},[t._v("#")]),t._v(" Activate accounts")]),t._v(" "),a("p",[t._v("By default, accounts are automatically activated on registration. You may want to change this so you add a step to the registration process.")]),t._v(" "),a("p",[t._v("To deactivate autoactivation, set the environment variable "),a("code",[t._v("AUTO_ACTIVATE_NEW_USERS=false")])]),t._v(" "),a("p",[t._v("In addition to this, you can send a verification email with an activation link. You will then need to "),a("a",{attrs:{href:"#enable-emails"}},[t._v("configure the connection to a SMTP server")]),t._v(".")]),t._v(" "),a("p",[t._v("If SMTP is enabled, then the user will receive an email with an activation link. If the activation succeeds, the user is redirected to the url found in the "),a("code",[t._v("REDIRECT_URL_SUCCESS")]),t._v(" environment variable. If it fails, they will redirected to the url given by the "),a("code",[t._v("REDIRECT_URL_ERROR")]),t._v(" environment variable.")]),t._v(" "),a("p",[t._v("You can change the default email templates. In order to do so, you can mount "),a("a",{attrs:{href:"#custom-configuration-files"}},[t._v("custom configuration files")]),t._v(" when using docker, or change files in the "),a("a",{attrs:{href:"https://github.com/nhost/hasura-backend-plus/tree/master/custom",target:"_blank",rel:"noopener noreferrer"}},[t._v("custom directory"),a("OutboundLink")],1),t._v(" when running HBP from the source code.\nOther email templates are available and described "),a("a",{attrs:{href:"#email-templates"}},[t._v("here")])]),t._v(" "),a("h3",{attrs:{id:"limit-email-domains"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#limit-email-domains"}},[t._v("#")]),t._v(" Limit email domains")]),t._v(" "),a("p",[t._v("You can limit registration to ranges of emails that are only part of a whitelist. For instance, you may want to limit registration only to the email addresses of your own organisation. You can pass a list of comma-separated email domains to the "),a("code",[t._v("ALLOWED_EMAIL_DOMAINS")]),t._v(" environment variable, for instance:")]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("ALLOWED_EMAIL_DOMAINS=gmail.com,yourorganisation.com\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("h3",{attrs:{id:"password-constraints"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#password-constraints"}},[t._v("#")]),t._v(" Password constraints")]),t._v(" "),a("p",[t._v("By default, clients can register with a password of at least three characters. You can change this in setting a higher value:")]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("MIN_PASSWORD_LENGTH=6\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("p",[t._v("You can ask HBP to check on "),a("a",{attrs:{href:"https://haveibeenpwned.com/Passwords",target:"_blank",rel:"noopener noreferrer"}},[t._v("Have I Been Pwned"),a("OutboundLink")],1),t._v(" if the password has been previously exposed in data breaches. If so, the registration will fail. This option is disabled by default. You can change it to:")]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("HIBP_ENABLE=true\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("h3",{attrs:{id:"additional-registration-fields"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#additional-registration-fields"}},[t._v("#")]),t._v(" Additional registration fields")]),t._v(" "),a("p",[t._v("You may want to extend the "),a("code",[t._v("public.users")]),t._v(" table with your own fields and relations, and to expect the client to set some of them when registering. It is possible to set a list of columns in the "),a("code",[t._v("REGISTRATION_CUSTOM_FIELDS")]),t._v(" environment value.")]),t._v(" "),a("p",[t._v("Here is an example on the way to proceed to add a "),a("code",[t._v("nickname")]),t._v(" value to the registration:")]),t._v(" "),a("ol",[a("li",[t._v("Add a column "),a("code",[t._v("nickname")]),t._v(" of type text to the "),a("code",[t._v("public.users")]),t._v(" table")]),t._v(" "),a("li",[t._v("Set the environment variable "),a("code",[t._v("REGISTRATION_CUSTOM_FIELDS=nickname")])]),t._v(" "),a("li",[t._v("The registration endpoint now expects a "),a("code",[t._v("nickname")]),t._v(" value in addition to "),a("code",[t._v("email")]),t._v(" and "),a("code",[t._v("password")])])]),t._v(" "),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[t._v("WARNING")]),t._v(" "),a("p",[t._v("Any given field must exist in the "),a("code",[t._v("users")]),t._v(" GraphQL type that corresponds to the "),a("code",[t._v("public.users")]),t._v(" PostgreSQL table, or registration will fail.")])]),t._v(" "),a("h2",{attrs:{id:"authentication"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#authentication"}},[t._v("#")]),t._v(" Authentication")]),t._v(" "),a("h3",{attrs:{id:"oauth-providers"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#oauth-providers"}},[t._v("#")]),t._v(" OAuth Providers")]),t._v(" "),a("h3",{attrs:{id:"two-factor-authentication"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#two-factor-authentication"}},[t._v("#")]),t._v(" Two-factor Authentication")]),t._v(" "),a("h2",{attrs:{id:"enable-emails"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#enable-emails"}},[t._v("#")]),t._v(" Enable emails")]),t._v(" "),a("h2",{attrs:{id:"custom-configuration-files"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#custom-configuration-files"}},[t._v("#")]),t._v(" Custom configuration files")]),t._v(" "),a("h3",{attrs:{id:"storage-rules"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#storage-rules"}},[t._v("#")]),t._v(" Storage Rules")]),t._v(" "),a("h3",{attrs:{id:"email-templates"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#email-templates"}},[t._v("#")]),t._v(" Email templates")]),t._v(" "),a("h3",{attrs:{id:"private-key"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#private-key"}},[t._v("#")]),t._v(" Private key")]),t._v(" "),a("h2",{attrs:{id:"custom-user-schema"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#custom-user-schema"}},[t._v("#")]),t._v(" Custom User Schema")]),t._v(" "),a("h2",{attrs:{id:"rate-limiting"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#rate-limiting"}},[t._v("#")]),t._v(" Rate limiting")]),t._v(" "),a("h2",{attrs:{id:"environment-variables"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#environment-variables"}},[t._v("#")]),t._v(" Environment Variables")]),t._v(" "),a("h3",{attrs:{id:"general-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#general-2"}},[t._v("#")]),t._v(" General")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("Name")]),t._v(" "),a("th",[t._v("Default")]),t._v(" "),a("th",[t._v("Description")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[a("code",[t._v("HASURA_ENDPOINT")]),t._v(" (required)")]),t._v(" "),a("td"),t._v(" "),a("td",[t._v("Url of the Hasura GraphQL engine endpoint used by the backend to access the database.")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("HASURA_GRAPHQL_ADMIN_SECRET")])]),t._v(" "),a("td"),t._v(" "),a("td",[t._v("The secret set in the Hasura GraphQL Engine to allow admin access to the service. "),a("strong",[t._v("Strongly recommended")]),t._v(".")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("PORT")])]),t._v(" "),a("td",[t._v("3000")]),t._v(" "),a("td",[t._v("Port of the service")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("SERVER_URL")])]),t._v(" "),a("td"),t._v(" "),a("td",[t._v("Current server URL. Currently used only for creating links from email templates")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("MAX_REQUESTS")])]),t._v(" "),a("td",[t._v("100")]),t._v(" "),a("td",[t._v("Maximum requests per IP within the following "),a("code",[t._v("TIME_FRAME")]),t._v(".")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("TIME_FRAME")])]),t._v(" "),a("td",[t._v("900000")]),t._v(" "),a("td",[t._v("Timeframe used to limit requests from the same IP, in milliseconds. Defaults to 15 minutes.")])])])]),t._v(" "),a("h3",{attrs:{id:"authentication-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#authentication-2"}},[t._v("#")]),t._v(" Authentication")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("Name")]),t._v(" "),a("th",[t._v("Default")]),t._v(" "),a("th",[t._v("Description")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[a("code",[t._v("ALLOWED_EMAIL_DOMAINS")])]),t._v(" "),a("td"),t._v(" "),a("td",[t._v("List of comma-separated email domain names that are allowed to register.")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("AUTO_ACTIVATE_NEW_USERS")])]),t._v(" "),a("td",[t._v("false")]),t._v(" "),a("td",[t._v("When set to true, automatically activate the users once registererd.")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("COOKIE_SECRET")])]),t._v(" "),a("td"),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[a("code",[t._v("DEFAULT_USER_ROLE")])]),t._v(" "),a("td",[t._v("user")]),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[a("code",[t._v("HIBP_ENABLE")])]),t._v(" "),a("td",[t._v("false")]),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[a("code",[t._v("JWT_ALGORITHM")])]),t._v(" "),a("td",[t._v("RS256")]),t._v(" "),a("td",[t._v("Valid values: RS256, RS384, RS512, HS256, HS384, HS512")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("JWT_KEY")])]),t._v(" "),a("td"),t._v(" "),a("td",[t._v("Encryption secret. Required when using a SHA (RS*) algorithm. When using a RSA algorithm (RS*), should contain a valid RSA PEM key, otherwise "),a("code",[t._v("JWT_KEY_FILE_PATH")]),t._v(" will be used.")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("JWT_EXPIRES_IN")])]),t._v(" "),a("td",[t._v("15")]),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[a("code",[t._v("JWT_KEY_FILE_PATH")])]),t._v(" "),a("td",[t._v("custom/keys/private.pem")]),t._v(" "),a("td",[t._v("Path to the RSA PEM private key file when using a RSA (RS*) algorithm and no "),a("code",[t._v("JWT_KEY")]),t._v(" is set. When used, will create a random key if the file is not found.")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("MIN_PASSWORD_LENGTH")])]),t._v(" "),a("td",[t._v("3")]),t._v(" "),a("td",[t._v("Minimum allowed password length.")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("REDIRECT_URL_ERROR")])]),t._v(" "),a("td"),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[a("code",[t._v("REDIRECT_URL_SUCCESS")])]),t._v(" "),a("td"),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[a("code",[t._v("JWT_REFRESH_EXPIRES_IN")])]),t._v(" "),a("td",[t._v("43200")]),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[a("code",[t._v("SMTP_ENABLE")])]),t._v(" "),a("td",[t._v("false")]),t._v(" "),a("td",[t._v("When set to true, emails are sent on certain steps, like after registration for account activation when autoactivation is deactivated, or for changing emails or passwords")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("SMTP_HOST")])]),t._v(" "),a("td"),t._v(" "),a("td",[t._v("SMTP server path to use for sending emails.")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("SMTP_PASS")])]),t._v(" "),a("td"),t._v(" "),a("td",[t._v("Password to authenticate on the SMTP server.")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("SMTP_USER")])]),t._v(" "),a("td"),t._v(" "),a("td",[t._v("Username to authenticate on the SMTP server.")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("SMTP_PORT")])]),t._v(" "),a("td",[t._v("587")]),t._v(" "),a("td",[t._v("SMTP server port.")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("SMTP_SECURE")])]),t._v(" "),a("td",[t._v("false")]),t._v(" "),a("td",[t._v("Set to true when the SMTP uses SSL.")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("REGISTRATION_CUSTOM_FIELDS")])]),t._v(" "),a("td"),t._v(" "),a("td",[t._v("Fields that need to be passed on to the registration patload, and that correspond to columns of the "),a("code",[t._v("public.users")]),t._v("table.")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("JWT_CUSTOM_FIELDS")])]),t._v(" "),a("td"),t._v(" "),a("td",[t._v("List of comma-separated column names from the "),a("code",[t._v("public.users")]),t._v(" tables that will be added to the "),a("code",[t._v("https://hasura.io/jwt/claims")]),t._v("JWT claims. Column names are kebab-cased and prefixed with "),a("code",[t._v("x-")]),t._v(".")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("OTP_ISSUER")])]),t._v(" "),a("td",[t._v("HBP")]),t._v(" "),a("td",[t._v("One-Time Password issuer name used with Muti-factor authentication.")])])])]),t._v(" "),a("h3",{attrs:{id:"storage"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#storage"}},[t._v("#")]),t._v(" Storage")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("Name")]),t._v(" "),a("th",[t._v("Default")]),t._v(" "),a("th",[t._v("Description")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[a("code",[t._v("S3_ACCESS_KEY_ID")])]),t._v(" "),a("td"),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[a("code",[t._v("S3_BUCKET")])]),t._v(" "),a("td"),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[a("code",[t._v("S3_ENDPOINT")])]),t._v(" "),a("td"),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[a("code",[t._v("S3_SECRET_ACCESS_KEY")])]),t._v(" "),a("td"),t._v(" "),a("td")])])])])}),[],!1,null,null,null);e.default=s.exports}}]);